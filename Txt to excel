Sub ImportTxtFilesWithFormatting()
    Dim FilePath As String, FileName As String
    Dim Wb As Workbook
    Dim Ws As Worksheet
    Dim FoundColumn As Range
    Dim LastRow As Long
    Dim i As Long
    Dim ColumnToChange As String
    
    ' Folder containing .txt files
    FilePath = "C:\YourFolderPath\" ' Update with your folder path
    FileName = Dir(FilePath & "*.txt")
    
    Application.ScreenUpdating = False
    
    Do While FileName <> ""
        ' Open the .txt file as a workbook
        Set Wb = Workbooks.Open(FilePath & FileName)
        Set Ws = Wb.Sheets(1)
        
        ' Automatically find the column named "NRB" in the header row
        Set FoundColumn = Ws.Rows(1).Find(What:="NRB", LookIn:=xlValues, LookAt:=xlWhole)
        
        If Not FoundColumn Is Nothing Then
            ' Convert the column to Text format
            ColumnToChange = FoundColumn.Address(False, False) ' Get the column letter
            Ws.Columns(FoundColumn.Column).NumberFormat = "@"
            
            ' Replace commas with dots in the column
            LastRow = Ws.Cells(Ws.Rows.Count, FoundColumn.Column).End(xlUp).Row
            For i = 1 To LastRow
                If Not IsEmpty(Ws.Cells(i, FoundColumn.Column).Value) Then
                    Ws.Cells(i, FoundColumn.Column).Value = Replace(Ws.Cells(i, FoundColumn.Column).Value, ",", ".")
                End If
            Next i
        End If
        
        ' Save the workbook as an Excel file
        Wb.SaveAs Replace(FilePath & FileName, ".txt", ".xlsx"), FileFormat:=xlOpenXMLWorkbook
        Wb.Close False
        
        FileName = Dir ' Process the next .txt file
    Loop
    
    Application.ScreenUpdating = True
    MsgBox "All .txt files have been imported and formatted."
End Sub

Sub FormatExcelFiles()
    Dim FilePath As String, FileName As String
    Dim Wb As Workbook
    Dim Ws As Worksheet
    
    ' Folder containing Excel files
    FilePath = "C:\YourFolderPath\" ' Update with your folder path
    FileName = Dir(FilePath & "*.xlsx")
    
    Application.ScreenUpdating = False
    
    Do While FileName <> ""
        ' Open the Excel file
        Set Wb = Workbooks.Open(FilePath & FileName)
        
        ' Format all worksheets
        For Each Ws In Wb.Sheets
            ' Set font size to 8
            Ws.Cells.Font.Size = 8
            
            ' Bold, wrap text, and freeze the first row
            With Ws.Rows(1)
                .Font.Bold = True
                .WrapText = True
            End With
            
            ' Freeze the first row
            Ws.Application.ActiveWindow.FreezePanes = False
            Ws.Rows(2).Select
            Ws.Application.ActiveWindow.FreezePanes = True
            
            ' Rename the worksheet to "Arkusz1"
            On Error Resume Next ' Handle duplicate name errors
            Ws.Name = "Arkusz1"
            On Error GoTo 0
        Next Ws
        
        ' Save and close the workbook
        Wb.Save
        Wb.Close False
        
        FileName = Dir ' Process the next Excel file
    Loop
    
    Application.ScreenUpdating = True
    MsgBox "All Excel files have been formatted."
End Sub
Sub ImportTxtFilesWithFormatting()
    Dim FilePath As String, FileName As String
    Dim Wb As Workbook
    Dim Ws As Worksheet
    Dim FoundColumn As Range
    Dim i As Integer
    
    ' Folder containing .txt files
    FilePath = "C:\YourFolderPath\" ' Update with your folder path
    If Right(FilePath, 1) <> "\" Then FilePath = FilePath & "\"
    
    FileName = Dir(FilePath & "*.txt")
    
    If FileName = "" Then
        MsgBox "No .txt files found in the specified folder.", vbExclamation
        Exit Sub
    End If
    
    Application.ScreenUpdating = False
    
    Do While FileName <> ""
        ' Open the .txt file as a workbook
        Set Wb = Workbooks.Add
        Set Ws = Wb.Sheets(1)
        
        ' Open the .txt file and import it with delimiters
        With Ws.QueryTables.Add(Connection:="TEXT;" & FilePath & FileName, Destination:=Ws.Range("A1"))
            .TextFileParseType = xlDelimited
            .TextFileTextQualifier = xlTextQualifierDoubleQuote
            .TextFileConsecutiveDelimiter = False
            .TextFileTabDelimiter = True ' Change to match your file's delimiter
            .TextFileCommaDelimiter = False
            .TextFileSemicolonDelimiter = False
            .TextFileSpaceDelimiter = False
            .TextFileColumnDataTypes = GetColumnDataTypes(Ws, "NRB") ' Custom function to set NRB as text
            .Refresh BackgroundQuery:=False
        End With
        
        ' Save the workbook as an Excel file
        Wb.SaveAs Replace(FilePath & FileName, ".txt", ".xlsx"), FileFormat:=xlOpenXMLWorkbook
        Wb.Close False
        
        FileName = Dir ' Process the next .txt file
    Loop
    
    Application.ScreenUpdating = True
    MsgBox "All .txt files have been imported and formatted."
End Sub

Function GetColumnDataTypes(Ws As Worksheet, HeaderName As String) As Variant
    Dim DataTypes() As Integer
    Dim FoundColumn As Range
    Dim HeaderCount As Integer
    Dim i As Integer
    
    ' Detect number of columns in the first row
    HeaderCount = Ws.Cells(1, Ws.Columns.Count).End(xlToLeft).Column
    ReDim DataTypes(1 To HeaderCount)
    
    ' Default all columns to General
    For i = 1 To HeaderCount
        DataTypes(i) = xlGeneralFormat
    Next i
    
    ' Check if the specified header exists
    Set FoundColumn = Ws.Rows(1).Find(What:=HeaderName, LookIn:=xlValues, LookAt:=xlWhole)
    If Not FoundColumn Is Nothing Then
        DataTypes(FoundColumn.Column) = xlTextFormat ' Set NRB column as Text
    End If
    
    GetColumnDataTypes = DataTypes
End Function

